\documentclass[a4paper,11pt]{report}

\usepackage[german]{babel}
\usepackage{csquotes}
\usepackage{amsmath,amssymb}
\usepackage{hyperref}
\usepackage{subfiles}
\usepackage{xparse}
\usepackage{mathtools} % für \coloneqq
\usepackage{booktabs}  % für \toprule, \midrule, \bottomrule
\usepackage{tabularx}  % für tabularx-Umgebung
\usepackage{makecell}

% erst amsthm (falls formula-envs.tex es nicht selbst lädt; doppelt ist meist ok, aber sauber ist einmal)
\usepackage{amsthm}
\usepackage{xparse}
\usepackage{multirow}


\input{tex/impl/thmlookup.tex}
\input{tex/impl/formula-envs.tex}
\input{tex/impl/proof-tables.tex} 
\input{tex/impl/commands.tex}

% Verhindert Seitenumbruch innerhalb eines Regelschemas
\newenvironment{RuleSchema}{\begin{samepage}}{\end{samepage}}

\newcounter{file}

% --- thmlookup: pro Band in eigene Dateien schreiben ---
\directlua{
  function thmlookup.set_band_output(tag)
    local base = "registry/_" .. tag
    thmlookup.registry_path = base .. ".registry.tsv"
    thmlookup.debug_path    = base .. ".debug.log"

    -- Dateien leeren/neu anlegen
    local f = io.open(thmlookup.registry_path, "w"); if f then f:write(""); f:close() end
    local g = io.open(thmlookup.debug_path, "w");    if g then g:write(""); g:close() end

    texio.write_nl("thmlookup: output -> " .. thmlookup.registry_path)
  end
}

\newcommand{\ThmLookupBand}[1]{%
  \directlua{thmlookup.set_band_output("\luaescapestring{#1}")}%
}


\begin{document}

\FormulaThmAuto[Totale Relation]{R_M,M,\bigcup M}
\FormulaThmAuto[Totale Relation]{R^M,M,\bigcup M}



 \FormulaRefAuto{R_M,A,\bigcup A}{1}

\FormulaRefAuto{R_A,A,\bigcup A}{1}

 \FormulaRefAuto{R^M,A,\bigcup A}{1}

\FormulaRefAuto{R^A,A,\bigcup A}{1}

%\ThmLookupBand{B01}
%\subfile{B01}

%\clearpage
%\ThmLookupBand{B02}
%\subfile{B02}

%\clearpage
%\ThmLookupBand{B03}
%\subfile{B03}

% ggf. weitere Bände:
% \clearpage \ThmLookupBand{B04} \subfile{B04}

\end{document}
